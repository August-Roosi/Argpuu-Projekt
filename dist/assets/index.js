import{R as T,c as I,g as L,G as M,r as c,j as t,P as b,u as N,V as l,C as F,a as R,b as V,O as z,i as D,e as U,n as G,B as W,I as $,d as K}from"./index2.js";function P(e,r){if(Object.is(e,r))return!0;if(typeof e!="object"||e===null||typeof r!="object"||r===null)return!1;if(e instanceof Map&&r instanceof Map){if(e.size!==r.size)return!1;for(const[n,a]of e)if(!Object.is(a,r.get(n)))return!1;return!0}if(e instanceof Set&&r instanceof Set){if(e.size!==r.size)return!1;for(const n of e)if(!r.has(n))return!1;return!0}const s=Object.keys(e);if(s.length!==Object.keys(r).length)return!1;for(const n of s)if(!Object.prototype.hasOwnProperty.call(r,n)||!Object.is(e[n],r[n]))return!1;return!0}const{useRef:_}=T;function H(e){const r=_();return s=>{const n=e(s);return P(r.current,n)?r.current:r.current=n}}const X=I((e,r)=>({searchTerm:"",setSearchTerm:s=>{e({searchTerm:s,selectedArgument:null})},selectedArgument:null,setSelectedArgument:s=>{e({selectedArgument:s})},argumentsList:[],setArgumentsList:s=>{console.log("Setting arguments list:",s.length),e({argumentsList:s})},loadingArguments:!0,setLoadingArguments:s=>{e({loadingArguments:s})},filteredArguments:s=>r().argumentsList.filter(n=>{const a=n.data.content;return(a==null?void 0:a.toLowerCase().includes(r().searchTerm.toLowerCase()))&&n.id!==s}),getArgumentsFromApi:async s=>{const n=L();e({loadingArguments:!0});try{const a=await fetch(`/api/arguments/?exclude_argument_map=${s}`,{method:"GET",headers:new Headers({"Content-Type":"application/json","X-CSRFToken":n||""})});if(!a.ok)throw new Error(`Failed to fetch arguments: ${a.status}`);const f=(await a.json()).map(d=>({...d,type:"argument-node"}));e({argumentsList:f})}catch(a){console.error("Error fetching arguments:",a),e({argumentsList:[]})}finally{e({loadingArguments:!1})}}}));function Z(e){return M({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"48",d:"M244 400 100 256l144-144M120 256h292"},child:[]}]})(e)}const q=({title:e,targetUrl:r,author:s})=>{const[n,a]=c.useState(!1),[h,f]=c.useState(e),[d,m]=c.useState(!1),y=c.useCallback(()=>{a(!0)},[]),u=c.useCallback(()=>{m(!0)},[]),w=c.useCallback(()=>{a(!1)},[]),p=c.useCallback(g=>{g.key==="Enter"&&a(!1)},[]);return c.useEffect(()=>{if(d){const g=setTimeout(()=>m(!1),200);return()=>clearTimeout(g)}},[d]),t.jsxs("div",{children:[t.jsxs(b,{position:"top-left",className:"flex justify-between items-center bg-gray-100 shadow-md",children:[t.jsx("button",{className:"py-2 px-4 focus:bg-gray-800 ",onClick:()=>window.location.href=r,children:t.jsx(Z,{})}),t.jsx("div",{})]}),t.jsxs(b,{position:"top-center",className:`flex transition-colors duration-300 justify-center gap-4 items-center bg-gray-100 py-4 px-6 shadow-md 
                        ${d?"animate-radiate bg-yellow-300":""}`,children:[n?t.jsx("input",{type:"text",value:h,onChange:g=>f(g.target.value),onBlur:w,onKeyDown:p,autoFocus:!0,className:"text-xl bg-white border border-gray-300 rounded px-2 py-1"}):t.jsx("h1",{className:"text-xl cursor-pointer  px-2 py-1 rounded",onDoubleClick:y,onClick:u,children:h}),t.jsxs("h3",{className:"text-xs text-gray-600",children:["Autor: ",s]})]})]})};function J(e){return M({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M7.18,4,8.6,5.44,6.06,8h9.71a6,6,0,0,1,0,12h-2V18h2a4,4,0,0,0,0-8H6.06L8.6,12.51,7.18,13.92,2.23,9Z"},child:[]}]})(e)}const Q=({})=>{const e=N(n=>n.undo),r=N(n=>n.reloadMap),s=c.useCallback(async()=>{const n=await e();n[0]===0?l.error(n[1]):(l.success(n[1]),r())},[]);return t.jsx("div",{children:t.jsx(F,{orientation:"horizontal",position:"bottom-center",className:"bg-gray-100 shadow-md p-2 gap-2",children:t.jsx(R,{onClick:s,title:"Võta tagasi",children:t.jsx(J,{})})})})},x=window.argumentMapId,Y=window.argumentMapsViewUrl,B=window.argumentMapTitle,ee=window.argumentMapAuthor,j=window.isArgumentMapReadOnly,te=e=>({nodes:e.nodes,edges:e.edges,onNodesChange:e.onNodesChange,onEdgesChange:e.onEdgesChange,onConnect:e.onConnect,createArgument:e.createArgument,getMap:e.getMap,connectArguments:e.connectArguments,createArgumentWithConnection:e.createArgumentWithConnection,createSiblingArgument:e.createSiblingArgument});function ne(){const{nodes:e,edges:r,onNodesChange:s,onEdgesChange:n,onConnect:a,getMap:h,createArgumentWithConnection:f,createSiblingArgument:d}=N(H(te)),{isOpen:m,isSibling:y,nodeId:u,closeModal:w}=V(),{searchTerm:p,setSearchTerm:g,filteredArguments:S,getArgumentsFromApi:A,loadingArguments:O}=X(),k=c.useRef(null),v=()=>{g(""),w()};c.useEffect(()=>{console.log("Flow component has mounted."),console.log("Argument Map ID:",x),x&&!m&&h(x,j),m&&A(x);function o(i){k.current&&!k.current.contains(i.target)&&v()}return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[x,m,A]);const E=(o,i)=>{console.log("Node clicked:",i),console.log("Current edges:",r)},C=S(u??"");return t.jsxs("div",{style:{height:"100%"},className:"bg-gray-700",children:[t.jsx(z,{position:"top-center",reverseOrder:!1}),t.jsxs(D,{nodes:e,nodeTypes:G,onNodesChange:s,edges:r,edgeTypes:U,onEdgesChange:n,onNodeClick:E,onConnect:a,defaultEdgeOptions:{type:"smoothstep"},fitView:!0,zoomOnScroll:!1,panOnScroll:!0,fitViewOptions:{padding:.3},children:[t.jsx(q,{title:B,author:ee,targetUrl:Y}),t.jsx(Q,{}),t.jsx(W,{}),m&&t.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-gray-200 rounded-none w-[600px] max-h-[40vh] overflow-hidden shadow-lg",ref:k,children:[t.jsxs("div",{className:"flex-row justify-between items-center p-1 bg-gray-50",children:[t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{className:"px-1",onClick:()=>v(),children:t.jsx($,{})})}),t.jsx("input",{type:"text",autoFocus:!0,value:p,onChange:o=>g(o.target.value),onKeyDown:async o=>{if(o.key==="Enter"){if(j){l.error("Autor on keelanud kaardi redigeerimise.");return}if(p.length>1e3){l.error("Argumendi tekst on liiga pikk!");return}if(!u){l.error("Tekkis viga, palun proovi uuesti või saada arendajale tagasisidet.");return}let i;if(y?i=await d(u,{content:p}):i=await f(u,{content:p}),!i){l.error("Tekkis viga, palun proovi uuesti või saada arendajale tagasisidet.");return}v(),l.success("Argument loodud!")}},placeholder:"Otsi argumente või tee uus..",className:"w-full p-2 pl-8 rounded mb-4 text-xl bg-gray-50 focus:outline-none focus:bg-gray-50"})]}),t.jsxs("div",{className:"overflow-y-scroll max-h-[27vh] border-solid border-gray-300",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("div",{className:"p-3 text-gray-600 text-sm",children:"Teiste kaartide argumendid:"}),t.jsx("div",{className:"px-1 mr-3 text-sm bg-gray-300",children:C.length})]}),O?t.jsx("p",{className:"text-gray-600 p-3",children:"Laen argumente.."}):C.length===0?t.jsx("p",{className:"text-gray-600 p-3",children:"Argumente ei leitud."}):t.jsx("ul",{className:"space-y-1 ",children:C.map(o=>t.jsxs("li",{className:"p-3 pl-9 pb-1 pt-1 border rounded-none hover:bg-gray-100 cursor-pointer flex flex-col! justify-between items-center ",onClick:async()=>{if(j){l.error("Autor on keelanud kaardi redigeerimise.");return}if(!u){l.error("Tekkis viga, palun proovi uuesti või saada arendajale tagasisidet.");return}let i;if(y?i=await d(u,{newArgumentId:o.id}):i=await f(u,{newArgumentId:o.id}),!i){l.error("Tekkis viga, palun proovi uuesti või saada arendajale tagasisidet.");return}l.success("Argument kopeeritud teisest kaardist!")},children:[t.jsx("p",{className:`font-medium ${o.data.content!==""?"":"text-gray-500 text-sm"}`,children:o.data.content!==""?o.data.content:"tekst puudu"}),t.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["ID: ",o.id]})]},o.id))})]})]})})]})]})}K.createRoot(document.getElementById("root")).render(t.jsx(T.StrictMode,{children:t.jsx(ne,{})}));
